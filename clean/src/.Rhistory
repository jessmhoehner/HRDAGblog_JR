require(pacman)
p_load(dplyr,styler,tidyverse,readr,assertr)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"),
output1=here::here("test/output/death1_test.txt"),
output2=here::here("test/output/death2_test.txt"))
stopifnot(is.list(files)== TRUE)
death1 <- readr::read_delim(files$input1, delim="|")
death2 <- readr::read_delim(files$input2, delim="|")
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/clean/src/clean.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,forcats,readr,janitor,assertr)
files <- list(input1=here::here("clean/input/death_data_1_122219.txt"),
input2=here::here("clean/input/death_data_2_122219.txt"),
output1=here::here("clean/output/death1_clean.txt"),
output2=here::here("clean/output/death2_clean.txt"))
stopifnot(is.list(files)== TRUE)
#set boundaries for dates of interest
dt_boundary_01 <- as.Date("2019-08-01")
dt_boundary_21 <- as.Date("2019-08-21")
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(age = as.integer(age)) %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190801 = ifelse(date < dt_boundary_01, "pre", "post"),
dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(sex,status, dateb_20190801, dateb_20190821), as.factor)
#retain only people with status "dead" and add in dates with no deaths
death1 <-
filter(death1, status == "dead") %>%
complete(DOD = seq.Date(min(DOD), max(DOD), by="day")) %>%
write_delim(files$output1, delim="|")
stopifnot(ncol(death1) == 8 & (nrow (death1) == 134))
death2 <- readr::read_delim(files$input2, delim="|") %>%
clean_names() %>%
mutate(age = as.integer(age)) %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190801 = ifelse(date < dt_boundary_01, "pre", "post"),
dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(sex,status, dateb_20190801, dateb_20190821), as.factor)
setwd("~/HRDAGblog_JR/test/src")
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/test/src/test.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,readr,assertr)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"),
output1=here::here("test/output/death1_test.txt"),
output2=here::here("test/output/death2_test.txt"))
stopifnot(is.list(files)== TRUE)
death1 <- readr::read_delim(files$input1, delim="|")
setwd("~/HRDAGblog_JR/clean/src")
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/clean/src/clean.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,forcats,readr,janitor,assertr)
files <- list(input1=here::here("clean/input/death_data_1_122219.txt"),
input2=here::here("clean/input/death_data_2_122219.txt"),
output1=here::here("test/input/death1_clean.txt"),
output2=here::here("test/input/death2_clean.txt"))
stopifnot(is.list(files)== TRUE)
#set boundaries for dates of interest
dt_boundary_01 <- as.Date("2019-08-01")
dt_boundary_21 <- as.Date("2019-08-21")
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(age = as.integer(age)) %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190801 = ifelse(date < dt_boundary_01, "pre", "post"),
dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(sex,status, dateb_20190801, dateb_20190821), as.factor)
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/clean/src/clean.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,forcats,readr,janitor,assertr)
files <- list(input1=here::here("clean/input/death_data_1_122219.txt"),
input2=here::here("clean/input/death_data_2_122219.txt"),
output1=here::here("test/input/death1_clean.txt"),
output2=here::here("test/input/death2_clean.txt"))
stopifnot(is.list(files)== TRUE)
#set boundaries for dates of interest
dt_boundary_01 <- as.Date("2019-08-01")
dt_boundary_21 <- as.Date("2019-08-21")
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(age = as.integer(age)) %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190801 = ifelse(date < dt_boundary_01, "pre", "post"),
dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(sex,status, dateb_20190801, dateb_20190821), as.factor)
