install.packages("tinytex")
install.packages("tinytex")
tinytex::tlmgr_update()
tinytex::install_tinytex()
tinytex::tlmgr_update()
require (pacman)
pacman::p_load(dplyr,tidyverse,readr,assertr, ggplot2,scales,incidence,tinytex)
require (pacman)
pacman::p_load(dplyr,tidyverse,readr,assertr, ggplot2,scales,incidence,tinytex)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"))
death1 <- readr::read_delim(files$input1, delim="|")
require (pacman)
pacman::p_load(dplyr,tidyverse,readr,assertr, ggplot2,scales,incidence,tinytex)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"))
death1 <- readr::read_delim(files$input1, delim="|")
death2 <- readr::read_delim(files$input2, delim="|")
# compute daily incidence
date_case1<- incidence(death1$date, interval = 1 )
# plot
epiplot1<-
plot(date_case1, border = "black", show_cases =TRUE,
ylab = "Reported Deaths", xlab= "Date") +
scale_x_date(labels = date_format("%d %b %Y")) +
theme_grey() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, color = "black")) +
coord_fixed(ratio=3)
epiplot1
# compute daily incidence
date_case2<- incidence(death2$date, interval = 1 )
# plot
epiplot2<-
plot(date_case2, border = "black", show_cases=TRUE,
ylab = "Reported Deaths", xlab= "Date") +
scale_x_date(labels = date_format("%d %b %Y")) +
theme_grey() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, color = "black")) +
coord_fixed(ratio=5)
epiplot2
files <- list(cts1 = here::here("test/output/counts1_pre.txt"),
cts2 = here::here("test/output/counts1_post.txt"),
cts3 = here::here ("test/output/counts2_pre.txt"),
cts4 = here::here ("test/output/counts2_post.txt"))
cts1pre <- readr::read_delim(files$cts1, delim="|")
cts1post <- readr::read_delim(files$cts2, delim="|")
cts2pre <- readr::read_delim(files$cts3, delim="|")
cts2post <- readr::read_delim(files$cts4, delim="|")
# set 1
# mean deaths per day prior to 21 August 2019
mu1pre <- round(mean(cts1pre$n))
# mean deaths per day following 21 August 2019
mu1post <- round(mean(cts1post$n))
#test
res1 <-poisson.test(mu1pre, 1, mu1post, alternative = "g", conf.level = 0.95)
res1
# set 2
# mean deaths per day prior to 21 August 2019
mu2pre <- round(mean(cts2pre$n))
# mean deaths per day following 21 August 2019
mu2post <- round(mean(cts2post$n))
#test
res2 <- poisson.test(mu2pre, 1, mu2post, alternative = "g", conf.level = 0.95)
res2
# set 1
# maximum deaths per day prior to 21 August 2019
max1_pre <- max(cts1pre$n)
# maximum deaths per day following 21 August 2019
max1_post <- max(cts1post$n)
# set 2
# maximum deaths per day prior to 21 August 2019
max2_pre <- max(cts2pre$n)
# maximum deaths per day following 21 August 2019
max2_post <- max(cts2post$n)
# likelihood of observing the maximum deaths/day given the mean
# set 1
like1pre<-poisson.test(mu1pre, 1, max1_pre, alternative = "g", conf.level = 0.95)
like1pre
like1post<-poisson.test(mu1post, 1, max1_post, alternative = "g", conf.level = 0.95)
like1post
# set 2
like2pre<-poisson.test(mu2pre, 1, max2_pre, alternative = "g", conf.level = 0.95)
like2pre
like2post<-poisson.test(mu2post, 1, max2_post, alternative = "g", conf.level = 0.95)
like2post
sessionInfo()
files <- list(cts1 = here::here("test/output/counts1_pre.txt"),
cts2 = here::here("test/output/counts1_post.txt"),
cts3 = here::here ("test/output/counts2_pre.txt"),
cts4 = here::here ("test/output/counts2_post.txt"))
cts1pre <- readr::read_delim(files$cts1, delim="|")
cts1post <- readr::read_delim(files$cts2, delim="|")
cts2pre <- readr::read_delim(files$cts3, delim="|")
cts2post <- readr::read_delim(files$cts4, delim="|")
# set 1
# mean deaths per day prior to 21 August 2019
mu1pre <- round(mean(cts1pre$n))
# mean deaths per day following 21 August 2019
mu1post <- round(mean(cts1post$n))
#test
res1 <-poisson.test(mu1pre, 1, mu1post, alternative = "g", conf.level = 0.95)
# set 2
# mean deaths per day prior to 21 August 2019
mu2pre <- round(mean(cts2pre$n))
# mean deaths per day following 21 August 2019
mu2post <- round(mean(cts2post$n))
#test
res2 <- poisson.test(mu2pre, 1, mu2post, alternative = "g", conf.level = 0.95)
require (pacman)
pacman::p_load(dplyr,tidyverse,readr,assertr, ggplot2,scales,incidence,tinytex)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"))
death1 <- readr::read_delim(files$input1, delim="|")
death2 <- readr::read_delim(files$input2, delim="|")
head(deaths1)
require (pacman)
pacman::p_load(dplyr,tidyverse,readr,assertr, ggplot2,scales,incidence,tinytex)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"))
death1 <- readr::read_delim(files$input1, delim="|")
death2 <- readr::read_delim(files$input2, delim="|")
head(deaths1)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"))
death1 <- readr::read_delim(files$input1, delim="|")
death2 <- readr::read_delim(files$input2, delim="|")
head(death1)
head(death2)
setwd("~/HRDAGblog_JR/clean/src")
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/clean/src/clean.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,forcats,readr,janitor,assertr)
files <- list(input1=here::here("clean/input/death_data_1_122219.txt"),
input2=here::here("clean/input/death_data_2_122219.txt"),
output1=here::here("clean/output/death1_clean.txt"),
output2=here::here("clean/output/death2_clean.txt"))
stopifnot(is.list(files)== TRUE)
# set boundaries for date of interest
dt_boundary_21 <- as.Date("2019-08-21")
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(status,dateb_20190821), as.factor)
death1
death1 <- readr::read_delim(files$input1, delim="|")
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/clean/src/clean.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,forcats,readr,janitor,assertr)
files <- list(input1=here::here("clean/input/death_data_1_122219.txt"),
input2=here::here("clean/input/death_data_2_122219.txt"),
output1=here::here("clean/output/death1_clean.txt"),
output2=here::here("clean/output/death2_clean.txt"))
stopifnot(is.list(files)== TRUE)
# set boundaries for date of interest
dt_boundary_21 <- as.Date("2019-08-21")
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(status,dateb_20190821), as.factor)
# retain only people with status "dead" and add in dates with no deaths
death1 <-
filter(death1, status == "dead") %>%
write_delim(files$output1, delim="|")
stopifnot(ncol(death1) == 7 & (nrow (death1) == 105))
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(status,dateb_20190821), as.factor)
# retain only people with status "dead" and add in dates with no deaths
death1 <-
filter(death1, status == "dead") %>%
write_delim(files$output1, delim="|")
stopifnot(ncol(death1) == 4 & (nrow (death1) == 105))
death2 <- readr::read_delim(files$input2, delim="|") %>%
clean_names() %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(status, dateb_20190821), as.factor)
#!/usr/bin/env Rscript --vanilla
# set expandtab ft=R ts=4 sw=4 ai fileencoding=utf-8
#
# Author: JR
# Maintainer(s): JR, PB
# License: (c) HRDAG 2019, GPL v2 or newer
#
# -----------------------------------------------------------
# HRDAGblog_JR/clean/src/clean.R
#
require(pacman)
p_load(dplyr,styler,tidyverse,forcats,readr,janitor,assertr)
files <- list(input1=here::here("clean/input/death_data_1_122219.txt"),
input2=here::here("clean/input/death_data_2_122219.txt"),
output1=here::here("clean/output/death1_clean.txt"),
output2=here::here("clean/output/death2_clean.txt"))
stopifnot(is.list(files)== TRUE)
# set boundaries for date of interest
dt_boundary_21 <- as.Date("2019-08-21")
death1 <- readr::read_delim(files$input1, delim="|") %>%
clean_names() %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(status,dateb_20190821), as.factor)
# retain only people with status "dead" and add in dates with no deaths
death1 <-
filter(death1, status == "dead") %>%
write_delim(files$output1, delim="|")
stopifnot(ncol(death1) == 4 & (nrow (death1) == 105))
death2 <- readr::read_delim(files$input2, delim="|") %>%
clean_names() %>%
mutate(DOD = as.Date(`date`, "%Y/%m/%d")) %>%
mutate(dateb_20190821 = ifelse(date < dt_boundary_21, "pre", "post"))  %>%
mutate_at(vars(status, dateb_20190821), as.factor)
#retain only people with status "dead" and add in dates with no deaths
death2 <-
filter(death2, status == "dead") %>%
write_delim(files$output2, delim="|")
stopifnot(ncol(death2) == 4 & (nrow (death2) == 678))
######done####
require (pacman)
pacman::p_load(dplyr,tidyverse,readr,assertr, ggplot2,scales,incidence,tinytex)
files <- list(input1=here::here("clean/output/death1_clean.txt"),
input2=here::here("clean/output/death2_clean.txt"))
death1 <- readr::read_delim(files$input1, delim="|")
death2 <- readr::read_delim(files$input2, delim="|")
head(death1)
head(death2)
files <- list(cts1 = here::here("test/output/counts1_pre.txt"),
cts2 = here::here("test/output/counts1_post.txt"),
cts3 = here::here ("test/output/counts2_pre.txt"),
cts4 = here::here ("test/output/counts2_post.txt"))
cts1pre <- readr::read_delim(files$cts1, delim="|")
cts1post <- readr::read_delim(files$cts2, delim="|")
cts2pre <- readr::read_delim(files$cts3, delim="|")
cts2post <- readr::read_delim(files$cts4, delim="|")
# set 1
# mean deaths per day prior to 21 August 2019
mu1pre <- round(mean(cts1pre$n))
# mean deaths per day following 21 August 2019
mu1post <- round(mean(cts1post$n))
#test
res1 <-poisson.test(mu1pre, 1, mu1post, alternative = "g", conf.level = 0.95)
# set 2
# mean deaths per day prior to 21 August 2019
mu2pre <- round(mean(cts2pre$n))
# mean deaths per day following 21 August 2019
mu2post <- round(mean(cts2post$n))
#test
res2 <- poisson.test(mu2pre, 1, mu2post, alternative = "g", conf.level = 0.95)
